% Package declaration
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{preamble}[2020/01/27 Moritz's preamble package]


%=========%
% Options %
%=========%
% The available options for now are:
% Fonts: lmodern, gfsdidot, fourier, libertine, garamond
% colorlinks
% onehalfspacing, doublespacing
% german
\DeclareOption{english}{
    \newcommand{\babellang}{english}
    \newcommand{\langcode}{UK}
}
\DeclareOption{german}{
    \newcommand{\babellang}{ngerman}
    \newcommand{\langcode}{DE}
}

% Load chemistry and math packages
\DeclareOption{chemmath}{\newcommand{\loadchemistry}{1}}

% Set spacing
\newcommand{\setspace}{}
\DeclareOption{onehalfspacing}{
  \renewcommand{\setspace}{\RequirePackage[onehalfspacing]{setspace}}
}
\DeclareOption{doublespacing}{
  \renewcommand{\setspace}{\RequirePackage[doublespacing]{setspace}}
}

% Colorlinks
\DeclareOption{nocolorlinks}{
    \newcommand{\colorlinks}{false}
}
\DeclareOption{colorlinks}{
    \newcommand{\colorlinks}{true}
}

% Margins according to ACS StyleGuide standards
\newcommand{\geom}{}
\DeclareOption{geometry}{
	\renewcommand{\geom}{\RequirePackage[left=1.50cm, right=1.50cm, top=3.00cm, bottom=3.00cm]{geometry}}
}

% Font
\newcommand{\customfont}{}
\DeclareOption{kpfonts}{
    \renewcommand{\customfont}{\RequirePackage{kpfonts}}
}
\DeclareOption{lmodern}{
    \renewcommand{\customfont}{\RequirePackage{lmodern}} % Latex default font, but improved
}
\DeclareOption{fourier}{
    \renewcommand{\customfont}{\RequirePackage{fourier}} % Adobe Utopia font
}
\DeclareOption{garamond}{
    \renewcommand{\customfont}{\RequirePackage{ebgaramond-maths}} % Garamond
}
\DeclareOption{gyre}{
    \renewcommand{\customfont}{\RequirePackage{tgpagella}} % Tex Gyre Pagella
}
\DeclareOption{libertinus}{
    \renewcommand{\customfont}{\RequirePackage{libertinus}} % Libertinus, nice sans serif font
}

% End of options
\DeclareOption*{\PackageWarning{preamble}{Unknown \CurrentOption}}
\ExecuteOptions{nocolorlinks, english, kpfonts} % Default options
\ProcessOptions\relax

% Fix too many alphabets error
\newcommand\hmmax{0}
\newcommand\bmmax{0}

% Add document information
\date{\today}
\author{Moritz Wachsmuth-Melm}

%====================%
% Important packages %
%====================%
\RequirePackage[l2tabu, orthodox]{nag} % Warns of deprecated LaTeX constructs
\RequirePackage[T1] {fontenc} 
\RequirePackage[utf8]{inputenc}
\RequirePackage[\babellang]{babel} % Language specific small stuff (formatting and so on)
\RequirePackage{csquotes} % Better quoting, but mainly here because it is recommended for babel and biblatex
\RequirePackage[
backend=biber,
doi=true,
url=false,
eprint=false,
style=numeric-comp, % Haven't decided on a style yet
sorting=none, % Sorts in citation order, which is the only sorting method that makes sense if using numeric style
autocite=inline, % Options: plain,inline,footnote,superscript,
]{biblatex} % Biblatex, integrate with zotero using: https://github.com/retorquere/zotero-better-bibtex
\DeclarePrintbibliographyDefaults{title=References}


%========================%
% Miscellaneous packages %
%========================%
\customfont{} % Set the font
\RequirePackage{emptypage} % Ensures removed headers and footers on empty pages (like the one after the title)
\RequirePackage[final]{microtype} % Better font spacing and stuff. Final option provides that it is not disabled in draft mode
\RequirePackage{xspace} % In commands, \xspace makes a space after the command only if there is a word. In case of punctuation, it is omitted.
\setspace{} % Line spacing if needed (for thesis and so on)
% \RequirePackage{enumitem} % More control over lists
\RequirePackage[
per-mode=reciprocal-positive-first, % Format of units (fraction or reciprocal)
locale=\langcode, % Set locale
range-units=single, % Don't repeat units in number ranges
list-units=single, % Don't repeat units in number lists
detect-all, % Apply same font settings to the number/unit as the surrounding text
forbid-literal-units=true, % Only allow predefined units to enforce consistency
abbreviations=true, % Load abbreviations (\mg, \mmol, \ml etc.)
]{siunitx} % Nice SI units, but also for number formatting/alignment in tables (with s and S column specifier)
\DeclareSIUnit{\basepair}{bp} % Declare basepairs as a unit (important for DNA double strands)
\DeclareSIUnit{\base}{b} % Declare bases as a unit (important for DNA single strands)
\DeclareSIUnit{\molar}{\textsc{m}} % Declare molarity as unit (equals mol/l)
\DeclareSIUnit{\mmolar}{\milli\molar} % Short form for milli
\DeclareSIUnit{\umolar}{\micro\molar} % Short form for micro
\DeclareSIUnit{\enzymeunit}{U} % Declare units as unit (enzyme activity)
\DeclareSIUnit{\xg}{xg} % Declare centrifugal force (g) as unit
\DeclareSIUnit{\rpm}{rpm} % Declare rounds per minute as unit
\DeclareSIUnit{\hpi}{hpi} % Declare hours past infection as unit
\DeclareSIUnit[number-unit-product = {}]{\percent}{\%} % Remove space before percent sign
\DeclareSIUnit{\electron}{e^-}


%=====================%
% Chemistry and maths %
%=====================%
\ifx\loadchemistry\undefined
\else
	
	\RequirePackage{chemformula} % Stuff like \ch{MgCl2}
	\RequirePackage{chemmacros} % Extension of chemformula, most notably contains \iupac{}, very useful for long IUPAC names containing heteroatoms, stereochemistry, greek letters and stuff. Also allows line breaking
	\RequirePackage{chemfig} % Structural formulas drawn with tikz. Not so easy to use, but looks very nice. Still looking for an easier alternative
	\RequirePackage{mathtools} % Math stuff
	\RequirePackage{amsfonts} % Math stuff (continued)
	\RequirePackage{amssymb} % Math stuff (continued)
\fi


%=========================%
% Floats, figures, images %
%=========================%
\RequirePackage[section]{placeins} % Floats can not be printed behind the next section.
\RequirePackage{caption} % Better captions, more customisable
\RequirePackage{subcaption} % Subfigures, subcaptions
\RequirePackage{tikz} % Figures you can draw on (text, lines, braces, stuff)
\RequirePackage{xcolor} % Allow colored text

%=============%
% Table stuff %
%=============%
\RequirePackage{multirow} % \multicolumn{num_of_columns}{X}{Content} and \multirow{num_of_rows}{X}{Content}
\RequirePackage{multirow,bigdelim} % Braces spanning multiple rows
\RequirePackage{xltabular} % A combination of longtable and tabularx. Useful for multi=page tables
\RequirePackage{csvsimple} % Read csv files as tables
\RequirePackage{booktabs} % \toprule, \midrule, \bottomrule, nicer tables (must have!)

%===============================%
% Documentclass-specific stuff  %
%===============================%
\makeatletter%
\@ifclassloaded{beamer}{%if beamer is loaded
	\captionsetup[subfigure]{labelformat=empty}
	\captionsetup[figure]{labelformat=empty}
	\captionsetup[table]{labelformat=empty}
	\captionsetup[subtable]{labelformat=empty}
	\usepackage{pgfpages} % For typesetting notes on second screen with \setbeameroption{show notes on second screen}
	\setbeamertemplate{navigation symbols}{} % Remove navigation symbols
	% \setlist[description]{style=nextline} % Nicer descriptions
	% \setlist[itemize]{label=\textbullet} % Add bullets to lists
}{%other documentclass
	\geom{} 
	\RequirePackage[ % Hyperref
	pdfpagelabels=true, % Sets PDF page labels, so that PDF readers can detect different numbering styles (e.g. roman in \frontmatter)
	plainpages=false, % Fixes errors caused by page numbering resets (as by \frontmatter, \mainmatter and \backmatter)
	colorlinks=\colorlinks, % Make links (as in TOC or references to figures) font red instead of drawing a red box around them. Colorlinks are also visible in print, boxes are not
	bookmarks=true,% Make bookmarks
	final % Make links, no matter if draft mode or not
	]{hyperref} % Required for the hyperlinks within the PDF
	\usepackage{cleveref} % Better referencing with \cref{} (replaces \ref{})
	\RequirePackage{pdflscape} % Landscape pdf pages with \begin{landscape} ... \end{landscape}
	\RequirePackage[obeyFinal]{todonotes} % Allows TODO notes in the text with \todo{note}, then can make a \listoftodos
	\AtBeginDocument{\listoftodos}
}
\makeatother

%============================================================================%
%================= Fix booktabs - xltabular incompatibility =================%
% https://tex.stackexchange.com/questions/522920/xltabular-breaking-booktabs %
%============================================================================%
\makeatletter
\def\@BTrule[#1]{%
  \ifx\longtable\undefined
    \let\@BTswitch\@BTnormal
  \else\ifx\hline\LT@hline
    \nobreak
    \let\@BTswitch\@BLTrule
  \else
     \let\@BTswitch\@BTnormal
  \fi\fi
  \global\@thisrulewidth=#1\relax
  \ifnum\@thisruleclass=\tw@\vskip\@aboverulesep\else
  \ifnum\@lastruleclass=\z@\vskip\@aboverulesep\else
  \ifnum\@lastruleclass=\@ne\vskip\doublerulesep\fi\fi\fi
  \@BTswitch}
\makeatother


%============================================%
% Unicode characters (mostly the greek ones) %
%============================================%
% \DeclareUnicodeCharacter{0391}{\chemAlpha} % Α Greek Capital Letter Alpha
% \DeclareUnicodeCharacter{0392}{\chemBeta} % Β Greek Capital Letter Beta
% \DeclareUnicodeCharacter{0393}{\chemGamma} % Γ Greek Capital Letter Gamma
% \DeclareUnicodeCharacter{0394}{\chemDelta} % Δ Greek Capital Letter Delta
% \DeclareUnicodeCharacter{0395}{\chemEpsilon} % Ε Greek Capital Letter Epsilon
% \DeclareUnicodeCharacter{0396}{\chemZeta} % Ζ Greek Capital Letter Zeta
% \DeclareUnicodeCharacter{0397}{\chemEta} % Η Greek Capital Letter Eta
% \DeclareUnicodeCharacter{0398}{\chemTheta} % Θ Greek Capital Letter Theta
% \DeclareUnicodeCharacter{0399}{\chemIota} % Ι Greek Capital Letter Iota
% \DeclareUnicodeCharacter{039A}{\chemKappa} % Κ Greek Capital Letter Kappa
% \DeclareUnicodeCharacter{039B}{\chemLambda} % Λ Greek Capital Letter Lambda
% \DeclareUnicodeCharacter{039C}{\chemMu} % Μ Greek Capital Letter Mu
% \DeclareUnicodeCharacter{039D}{\chemNu} % Ν Greek Capital Letter Nu
% \DeclareUnicodeCharacter{039E}{\chemXi} % Ξ Greek Capital Letter Xi
% \DeclareUnicodeCharacter{039F}{\chemOmicron} % Ο Greek Capital Letter Omicron
% \DeclareUnicodeCharacter{03A0}{\chemPi} % Π Greek Capital Letter Pi
% \DeclareUnicodeCharacter{03A1}{\chemRho} % Ρ Greek Capital Letter Rho
% \DeclareUnicodeCharacter{03A3}{\chemSigma} % Σ Greek Capital Letter Sigma
% \DeclareUnicodeCharacter{03A4}{\chemTau} % Τ Greek Capital Letter Tau
% \DeclareUnicodeCharacter{03A5}{\chemUpsilon} % Υ Greek Capital Letter Upsilon
% \DeclareUnicodeCharacter{03A6}{\chemPhi} % Φ Greek Capital Letter Phi
% \DeclareUnicodeCharacter{03A7}{\chemChi} % Χ Greek Capital Letter Chi
% \DeclareUnicodeCharacter{03A8}{\chemPsi} % Ψ Greek Capital Letter Psi
% \DeclareUnicodeCharacter{03A9}{\chemOmega} % Ω Greek Capital Letters Omega
% \DeclareUnicodeCharacter{03B1}{\chemalpha} % α Greek Small Letter Alpha
% \DeclareUnicodeCharacter{03B2}{\chembeta} % β Greek Small Letter Beta
% \DeclareUnicodeCharacter{03B3}{\chemgamma} % γ Greek Small Letter Gamma
% \DeclareUnicodeCharacter{03B4}{\chemdelta} % δ Greek Small Letter Delta
% \DeclareUnicodeCharacter{03B5}{\chemepsilon} % ε Greek Small Letter Epsilon
% \DeclareUnicodeCharacter{03B6}{\chemzeta} % ζ Greek Small Letter Zeta
% \DeclareUnicodeCharacter{03B7}{\chemeta} % η Greek Small Letter Eta
% \DeclareUnicodeCharacter{03B8}{\chemtheta} % θ Greek Small Letter Theta
% \DeclareUnicodeCharacter{03B9}{\chemiota} % ι Greek Small Letter Iota
% \DeclareUnicodeCharacter{03BA}{\chemkappa} % κ Greek Small Letter Kappa
% \DeclareUnicodeCharacter{03BB}{\chemlambda} % λ Greek Small Letter Lambda
% \DeclareUnicodeCharacter{03BC}{\chemmu} % μ Greek Small Letter Mu
% \DeclareUnicodeCharacter{03BD}{\chemnu} % ν Greek Small Letter Nu
% \DeclareUnicodeCharacter{03BE}{\chemxi} % ξ Greek Small Letter Xi
% \DeclareUnicodeCharacter{03BF}{\chemomicron} % ο Greek Small Letter Omicron
% \DeclareUnicodeCharacter{03C0}{\chempi} % π Greek Small Letter Pi
% \DeclareUnicodeCharacter{03C1}{\chemrho} % ρ Greek Small Letter Rho
% \DeclareUnicodeCharacter{03C3}{\chemsigma} % σ Greek Small Letter Sigma
% \DeclareUnicodeCharacter{03C4}{\chemtau} % τ Greek Small Letter Tau
% \DeclareUnicodeCharacter{03C5}{\chemupsilon} % υ Greek Small Letter Upsilon
% \DeclareUnicodeCharacter{03C6}{\chemphi} % φ Greek Small Letter Phi
% \DeclareUnicodeCharacter{03C7}{\chemchi} % χ Greek Small Letter Chi
% \DeclareUnicodeCharacter{03C8}{\chempsi} % ψ Greek Small Letter Psi
% \DeclareUnicodeCharacter{03C9}{\chemomega} % ω Greek Small Letter Omega
\endinput
